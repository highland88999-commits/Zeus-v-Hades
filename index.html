<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HADES vs ZEUS: NEON SOUL RACE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-cyan: #00f0ff;
            --neon-magenta: #ff0066;
            --neon-green: #39ff14;
            --neon-yellow: #ffe700;
            --neon-purple: #c300ff;
            --joy-size: clamp(110px, 24vh, 180px);
        }

        * { box-sizing: border-box; margin:0; padding:0; }

        body {
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            background: #000;
            color: var(--neon-cyan);
            overflow: hidden;
            height: 100dvh;
            touch-action: none;
        }

        #stars {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at bottom, #0b001f 0%, #000 100%);
            z-index: -2;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255,255,255,0.8);
            animation: twinkle 5s infinite alternate;
        }

        @keyframes twinkle { 0%,100% { opacity:0.35; } 50% { opacity: 0.95; } }

        #gameContainer {
            position: relative;
            width: 100dvw;
            height: 100dvh;
            overflow: hidden;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }

        /* UI Layers */
        #start-screen,
        #difficulty-screen,
        #game-over-screen {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.88);
            backdrop-filter: blur(12px);
            z-index: 30;
            padding: 2rem;
            text-align: center;
        }

        .hidden { display: none !important; }

        h1.glitch {
            font-size: clamp(3rem, 10vw, 7rem);
            font-weight: 900;
            letter-spacing: 0.12em;
            text-shadow: 0 0 30px var(--neon-magenta), 0 0 60px var(--neon-cyan);
            background: linear-gradient(90deg, var(--neon-magenta), var(--neon-cyan), var(--neon-magenta));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%,100% { text-shadow: 4px 0 var(--neon-magenta), -4px 0 var(--neon-cyan); }
            20%  { text-shadow: -4px 0 var(--neon-magenta), 4px 0 var(--neon-cyan); }
            40%  { text-shadow: 4px 0 var(--neon-cyan), -4px 0 var(--neon-magenta); }
            60%  { text-shadow: -6px 0 var(--neon-magenta), 6px 0 var(--neon-cyan); }
            80%  { text-shadow: 6px 0 var(--neon-cyan), -6px 0 var(--neon-magenta); }
        }

        .neon-btn {
            padding: clamp(1.2rem, 5vw, 1.8rem) clamp(2.5rem, 10vw, 4rem);
            margin: 1.2rem;
            font-size: clamp(1.3rem, 5vw, 2rem);
            font-weight: 700;
            color: white;
            background: rgba(0,0,0,0.5);
            border: 3px solid;
            border-radius: 1.2rem;
            cursor: pointer;
            transition: all 0.25s ease;
            backdrop-filter: blur(12px);
            box-shadow: 0 0 35px;
            position: relative;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
        }

        .neon-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.25), transparent);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .neon-btn:hover::before,
        .neon-btn:active::before { opacity: 1; }

        .neon-btn:hover { transform: scale(1.08); box-shadow: 0 0 60px currentColor !important; }

        #zeus-btn   { border-color: var(--neon-cyan);   box-shadow: 0 0 40px var(--neon-cyan);   background: linear-gradient(135deg, #003366, #001122); }
        #hades-btn  { border-color: var(--neon-magenta); box-shadow: 0 0 40px var(--neon-magenta); background: linear-gradient(135deg, #330033, #110011); }
        #easy-btn   { border-color: var(--neon-green);   box-shadow: 0 0 35px var(--neon-green); }
        #medium-btn { border-color: var(--neon-yellow);  box-shadow: 0 0 35px var(--neon-yellow); }
        #hard-btn   { border-color: var(--neon-magenta); box-shadow: 0 0 40px var(--neon-magenta); }

        #hud {
            position: fixed;
            top: 0; left: 0; right: 0;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(12px);
            z-index: 25;
            font-size: clamp(1.1rem, 3.5vw, 1.6rem);
            pointer-events: none;
        }

        .score-box {
            background: rgba(10,10,30,0.7);
            padding: 0.6rem 1.4rem;
            border-radius: 1rem;
            border: 1px solid;
            box-shadow: 0 0 25px;
        }

        #player-score-box { border-color: var(--neon-cyan);   color: var(--neon-cyan); }
        #opponent-score-box { border-color: var(--neon-magenta); color: var(--neon-magenta); }

        #timer { color: var(--neon-yellow); font-weight: 900; }

        #joystick-area {
            position: fixed;
            bottom: clamp(30px, 6vh, 60px);
            right: clamp(30px, 6vw, 60px);
            width: var(--joy-size);
            height: var(--joy-size);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.6s ease;
            pointer-events: none;
        }

        #joystick-area.visible { opacity: 1; pointer-events: auto; }

        #joystick-base {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.08);
            border: 3px solid rgba(0,240,255,0.45);
            box-shadow: inset 0 0 30px rgba(0,240,255,0.3);
        }

        #joystick-knob {
            position: absolute;
            width: 38%;
            height: 38%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, white, var(--neon-cyan));
            box-shadow: 0 0 30px var(--neon-cyan), inset 0 0 12px white;
            transform: translate(-50%, -50%);
            left: 50%;
            top: 50%;
            transition: transform 0.08s ease;
        }

        /* Scanlines */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(to bottom, transparent 0, transparent 2px, rgba(0,0,0,0.28) 2px, rgba(0,0,0,0.28) 4px);
            pointer-events: none;
            z-index: 999;
            opacity: 0.45;
        }
    </style>
</head>
<body>

<div id="stars"></div>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>

    <!-- START SCREEN -->
    <div id="start-screen">
        <h1 class="glitch">NEON SOUL RACE</h1>
        <p style="font-size: clamp(1.4rem, 4.5vw, 2.2rem); margin: 2rem 0; text-shadow: 0 0 15px var(--neon-cyan);">ZEUS âš¡ vs HADES ðŸ’€</p>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem;">
            <button id="zeus-btn"  class="neon-btn">âš¡ CYBER ZEUS</button>
            <button id="hades-btn" class="neon-btn">ðŸ’€ VOID HADES</button>
        </div>
    </div>

    <!-- DIFFICULTY SCREEN -->
    <div id="difficulty-screen" class="hidden">
        <h1 class="glitch" style="font-size: clamp(2.8rem, 9vw, 5.5rem);">CHOOSE PATH</h1>
        <div style="margin: 3rem 0; display: flex; flex-direction: column; gap: 1.8rem; width: min(90%, 420px);">
            <button class="neon-btn" id="easy-btn">SEEKER (Easy)</button>
            <button class="neon-btn" id="medium-btn">ON THE PATH (Medium)</button>
            <button class="neon-btn" id="hard-btn">MASTER (Expert)</button>
        </div>
    </div>

    <!-- HUD -->
    <div id="hud" class="hidden">
        <div id="player-score-box" class="score-box">
            YOU: <span id="player-score">0</span>
        </div>
        <div id="timer">2:00</div>
        <div id="opponent-score-box" class="score-box">
            OPP: <span id="opponent-score">0</span>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="game-over-screen" class="hidden">
        <h1 class="glitch">RACE TERMINATED</h1>
        <p id="final-result" style="font-size: clamp(1.6rem, 5vw, 2.8rem); margin: 2rem 0;"></p>
        <p id="final-score-text" style="font-size: clamp(1.4rem, 4vw, 2.2rem); color: var(--neon-yellow);"></p>
        <button id="restart-btn" class="neon-btn" style="margin-top: 3rem;">RE-ENTER THE ARENA</button>
    </div>

    <!-- Joystick -->
    <div id="joystick-area">
        <div id="joystick-base">
            <div id="joystick-knob"></div>
        </div>
    </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WORLD_W = 4800;
const WORLD_H = 3600;
const GAME_DURATION = 120;          // 2 minutes
const POSEIDON_INTERVAL = 30;       // every 30s
const SOUL_COUNT_BASE = 80;

const DIFFICULTY = {
    easy:   { aiSpeed: 4.2, aiAggression: 0.6, redChance: 0.15 },
    medium: { aiSpeed: 5.4, aiAggression: 0.85, redChance: 0.25 },
    hard:   { aiSpeed: 6.8, aiAggression: 1.0,  redChance: 0.40 }
};

let difficulty = null; // 'easy' | 'medium' | 'hard'

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let canvas, ctx;
let player, opponent, souls = [], particles = [], stars = [];
let camX = 0, camY = 0;
let timeRemaining = GAME_DURATION;
let poseidonTimer = POSEIDON_INTERVAL;
let isRunning = false;
let joystickActive = false;
let lastTouchId = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DOM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const startScreen      = document.getElementById('start-screen');
const difficultyScreen = document.getElementById('difficulty-screen');
const gameOverScreen   = document.getElementById('game-over-screen');
const hud              = document.getElementById('hud');
const joystickArea     = document.getElementById('joystick-area');
const joystickKnob     = document.getElementById('joystick-knob');
const playerScoreEl    = document.getElementById('player-score');
const opponentScoreEl  = document.getElementById('opponent-score');
const timerEl          = document.getElementById('timer');
const finalResultEl    = document.getElementById('final-result');
const finalScoreEl     = document.getElementById('final-score-text');
const restartBtn       = document.getElementById('restart-btn');

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');

    createBackgroundStars();
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Button listeners
    document.getElementById('zeus-btn').onclick  = () => showDifficulty('Zeus');
    document.getElementById('hades-btn').onclick = () => showDifficulty('Hades');

    document.getElementById('easy-btn').onclick   = () => startRace('easy');
    document.getElementById('medium-btn').onclick = () => startRace('medium');
    document.getElementById('hard-btn').onclick   = () => startRace('hard');

    restartBtn.onclick = () => {
        gameOverScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
    };

    setupControls();
}

function createBackgroundStars() {
    for (let i = 0; i < 600; i++) {
        stars.push({
            x: Math.random() * WORLD_W,
            y: Math.random() * WORLD_H,
            size: Math.random() * 2.2 + 0.4,
            phase: Math.random() * Math.PI * 2,
            speed: Math.random() * 0.015 + 0.004
        });
    }
}

function resizeCanvas() {
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GAME FLOW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showDifficulty(char) {
    startScreen.classList.add('hidden');
    difficultyScreen.classList.remove('hidden');
    playerChar = char;
}

let playerChar = null;

function startRace(diff) {
    difficulty = diff;
    difficultyScreen.classList.add('hidden');
    hud.classList.remove('hidden');
    joystickArea.classList.add('visible');

    resetGameState();
    isRunning = true;
    requestAnimationFrame(loop);
    setInterval(gameTimer, 1000);
}

function resetGameState() {
    timeRemaining = GAME_DURATION;
    poseidonTimer = POSEIDON_INTERVAL;

    player = {
        x: WORLD_W / 2,
        y: WORLD_H / 2,
        size: 28,
        color: playerChar === 'Zeus' ? '#00e0ff' : '#ff1088',
        symbol: playerChar === 'Zeus' ? 'âš¡' : 'ðŸ’€',
        score: 0
    };

    opponent = {
        x: WORLD_W / 2 + (Math.random()-0.5)*800,
        y: WORLD_H / 2 + (Math.random()-0.5)*800,
        size: 28,
        color: playerChar === 'Zeus' ? '#ff1088' : '#00e0ff',
        symbol: playerChar === 'Zeus' ? 'ðŸ’€' : 'âš¡',
        score: 0,
        target: null
    };

    souls = [];
    particles = [];

    spawnSouls(SOUL_COUNT_BASE);
    updateHUD();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GAME TIMER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gameTimer() {
    if (!isRunning) return;
    timeRemaining--;
    poseidonTimer--;

    if (poseidonTimer <= 0) {
        triggerPoseidonFlood();
        poseidonTimer = POSEIDON_INTERVAL;
    }

    if (timeRemaining <= 0) {
        endGame();
    }

    updateHUD();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// POSEIDON FLOOD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function triggerPoseidonFlood() {
    souls = [];
    for (let i = 0; i < 15; i++) {
        addParticleBurst(WORLD_W/2 + (Math.random()-0.5)*WORLD_W*0.7,
                         WORLD_H/2 + (Math.random()-0.5)*WORLD_H*0.7,
                         '#00aaff', 40);
    }
    setTimeout(() => spawnSouls(SOUL_COUNT_BASE), 1800);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SPAWN & COLLECT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spawnSouls(count) {
    const cfg = DIFFICULTY[difficulty];
    for (let i = 0; i < count; i++) {
        const isRed = Math.random() < cfg.redChance;
        souls.push({
            x: Math.random() * WORLD_W,
            y: Math.random() * WORLD_H,
            radius: 12,
            color: isRed ? '#ff4444' : '#88ddff',
            value: isRed ? -25 : 100,
            pulse: Math.random() * Math.PI * 2
        });
    }
}

function collectSoul(soul, collector) {
    collector.score += soul.value;
    addParticleBurst(soul.x, soul.y, soul.color, 24);
    if (navigator.vibrate) navigator.vibrate(soul.value > 0 ? 40 : 80);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAIN LOOP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loop(ts) {
    if (!isRunning) return;

    update();
    draw();

    requestAnimationFrame(loop);
}

function update() {
    // Player follows touch / joystick exactly
    // (handled in touch events below)

    updateOpponent();
    checkCollections();
    updateParticles();
}

function updateOpponent() {
    const cfg = DIFFICULTY[difficulty];

    if (!opponent.target || !souls.includes(opponent.target)) {
        if (souls.length === 0) return;
        opponent.target = souls.reduce((best, s) => {
            const d1 = Math.hypot(opponent.x - best.x, opponent.y - best.y);
            const d2 = Math.hypot(opponent.x - s.x,     opponent.y - s.y);
            return d2 < d1 ? s : best;
        }, souls[0]);
    }

    const dx = opponent.target.x - opponent.x;
    const dy = opponent.target.y - opponent.y;
    const dist = Math.hypot(dx, dy);

    if (dist > 6) {
        const speed = cfg.aiSpeed * (cfg.aiAggression + Math.random()*0.2);
        opponent.x += (dx / dist) * speed;
        opponent.y += (dy / dist) * speed;
    } else {
        // collect
        const idx = souls.indexOf(opponent.target);
        if (idx !== -1) {
            collectSoul(souls[idx], opponent);
            souls.splice(idx, 1);
            opponent.target = null;
        }
    }

    // boundary
    opponent.x = Math.max(20, Math.min(WORLD_W-20, opponent.x));
    opponent.y = Math.max(20, Math.min(WORLD_H-20, opponent.y));
}

function checkCollections() {
    for (let i = souls.length - 1; i >= 0; i--) {
        const s = souls[i];
        const pd = Math.hypot(player.x - s.x, player.y - s.y);
        if (pd < 36) {
            collectSoul(s, player);
            souls.splice(i, 1);
        }
    }
}

function updateParticles() {
    for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.018;
        if (p.life <= 0) particles.splice(i, 1);
    }
}

function addParticleBurst(x, y, color, count = 30) {
    for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const spd = Math.random() * 9 + 3;
        particles.push({
            x, y,
            vx: Math.cos(angle) * spd,
            vy: Math.sin(angle) * spd,
            life: 1,
            color,
            size: Math.random() * 5 + 2
        });
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Background gradient (arena style changes per character)
    const grad = ctx.createRadialGradient(
        canvas.width/2, canvas.height/2, 0,
        canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)
    );

    if (playerChar === 'Zeus') {
        // Underworld dome â€“ dark purple / blue
        grad.addColorStop(0, '#0a001f');
        grad.addColorStop(0.4, '#1a0033');
        grad.addColorStop(1, '#000011');
    } else {
        // Cyber cityscape â€“ dark teal / cyan
        grad.addColorStop(0, '#001122');
        grad.addColorStop(0.4, '#002233');
        grad.addColorStop(1, '#000811');
    }

    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.translate(-camX, -camY);

    // Stars
    stars.forEach(s => {
        const alpha = 0.4 + Math.sin(s.phase + performance.now()*0.0008) * 0.4;
        ctx.globalAlpha = alpha;
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        ctx.fill();
    });
    ctx.globalAlpha = 1;

    // Souls
    souls.forEach(s => {
        const r = s.radius + Math.sin(s.pulse += 0.14) * 3;
        ctx.shadowColor = s.color;
        ctx.shadowBlur = 25;
        ctx.fillStyle = s.color;
        ctx.beginPath();
        ctx.arc(s.x, s.y, r, 0, Math.PI*2);
        ctx.fill();

        ctx.shadowBlur = 12;
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(s.x, s.y, r*0.4, 0, Math.PI*2);
        ctx.fill();
    });

    // Particles
    particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 18 * p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI*2);
        ctx.fill();
    });
    ctx.globalAlpha = 1;

    // Players
    [player, opponent].forEach(p => {
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 30;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fill();

        ctx.shadowBlur = 12;
        ctx.fillStyle = 'rgba(255,255,255,0.9)';
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size*0.45, 0, Math.PI*2);
        ctx.fill();

        ctx.shadowBlur = 0;
        ctx.fillStyle = 'white';
        ctx.font = `${p.size*1.6}px Orbitron, Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(p.symbol, p.x, p.y);
    });

    ctx.restore();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONTROLS â€“ Touch follows exactly
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupControls() {
    function pointerMove(e) {
        if (!isRunning) return;
        e.preventDefault();

        const touches = e.touches || [e];
        for (const touch of touches) {
            const rect = canvas.getBoundingClientRect();
            const tx = (touch.clientX - rect.left) * (WORLD_W / rect.width) + camX;
            const ty = (touch.clientY - rect.top)  * (WORLD_H / rect.height) + camY;

            player.x = tx;
            player.y = ty;

            // clamp
            player.x = Math.max(20, Math.min(WORLD_W-20, player.x));
            player.y = Math.max(20, Math.min(WORLD_H-20, player.y));
        }
    }

    canvas.addEventListener('touchstart', pointerMove, { passive: false });
    canvas.addEventListener('touchmove',  pointerMove, { passive: false });

    // Optional mouse support for desktop testing
    canvas.addEventListener('mousemove', e => {
        if (e.buttons !== 1) return;
        pointerMove(e);
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CAMERA â€“ follows player tightly
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateCamera() {
    camX = player.x - canvas.width  / 2;
    camY = player.y - canvas.height / 2;

    camX = Math.max(0, Math.min(WORLD_W - canvas.width,  camX));
    camY = Math.max(0, Math.min(WORLD_H - canvas.height, camY));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HUD & END
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateHUD() {
    playerScoreEl.textContent   = player.score;
    opponentScoreEl.textContent = opponent.score;

    const min = Math.floor(timeRemaining / 60);
    const sec = (timeRemaining % 60).toString().padStart(2,'0');
    timerEl.textContent = `${min}:${sec}`;
}

function endGame() {
    isRunning = false;
    joystickArea.classList.remove('visible');

    const diff = difficulty.toUpperCase();
    const result = player.score > opponent.score ? 'VICTORY' :
                   player.score < opponent.score ? 'DEFEAT' : 'DRAW';

    finalResultEl.innerHTML = `<span style="color:${result==='VICTORY'?'var(--neon-green)':'var(--neon-magenta)'}">${result} â€“ ${diff}</span>`;
    finalScoreEl.textContent = `YOU ${player.score} â€¢ OPP ${opponent.score}`;

    gameOverScreen.classList.remove('hidden');
    hud.classList.add('hidden');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// START
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload = init;
</script>
</body>
</html>
